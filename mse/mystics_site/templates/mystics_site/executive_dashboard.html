{% extends "mystics_site/base.html" %}
{% load static %}
{% block title %}Executive Dashboard • Mystics Insight Hub{% endblock %}

{% block content %}
<section class="ms-section ms-reveal">
  <div class="ms-section-h">
    <h2 class="ms-h2">Executive Dashboard</h2>
    <div class="ms-dim">High-signal team performance visuals • season {{ season }}</div>
  </div>

  <div class="ms-two">
    <div class="ms-card ms-card-glow">
      <div class="ms-card-h">
        <span class="ms-pill">Mystics Points per Game</span>
        <span class="ms-dim">{{ season }} • filled line</span>
      </div>
      <div class="ms-chartbox">
        <canvas id="mysticsPpgLine"></canvas>
      </div>
      <div class="ms-charthint ms-dim">Uses Game scores (works as long as games are synced).</div>
    </div>

    <div class="ms-card">
      <div class="ms-card-h">
        <span class="ms-pill">Mystics Avg Points per Quarter</span>
        <span class="ms-dim">2024 vs 2025 • bar chart</span>
      </div>
      <div class="ms-chartbox">
        <canvas id="mysticsSeasonBar"></canvas>
      </div>
      <div class="ms-charthint ms-dim">
        Bars represent average points per quarter (color by year). <span class="ms-ai-dim">({{ season }} line chart unchanged.)</span>
      </div>
    </div>
  </div>

  <div class="ms-card ms-reveal" style="margin-top:12px;">
    <div class="ms-card-h">
      <span class="ms-pill">Team vs Team Comparison</span>
      <span class="ms-dim">select two teams → generate</span>
    </div>

    <form id="compareForm" class="ms-search" onsubmit="return false;">
      <select id="teamA">
        {% for t in teams %}
          <option value="{{ t.api_id }}">{{ t.full_name }}</option>
        {% endfor %}
      </select>

      <select id="teamB">
        {% for t in teams %}
          <option value="{{ t.api_id }}" {% if mystics and t.api_id == mystics.api_id %}selected{% endif %}>
            {{ t.full_name }}
          </option>
        {% endfor %}
      </select>

      <select id="compareSeason">
        <option value="2025" {% if season == 2025 %}selected{% endif %}>2025</option>
        <option value="2024">2024</option>
      </select>

      <button class="ms-btn ms-btn-small" id="runCompare" type="button">Generate</button>
    </form>

    <div class="ms-two" style="margin-top:12px;">
      <div class="ms-card ms-card-glow">
        <div class="ms-card-h">
          <span class="ms-pill">Points Trend</span>
          <span class="ms-dim">union-date line chart</span>
        </div>
        <div class="ms-chartbox">
          <canvas id="compareLine"></canvas>
        </div>
      </div>

      <div class="ms-card">
        <div class="ms-card-h">
          <span class="ms-pill">Avg Points per Quarter</span>
          <span class="ms-dim">bar chart</span>
        </div>
        <div class="ms-chartbox">
          <canvas id="compareBar"></canvas>
        </div>
      </div>
    </div>

    <div class="ms-charthint ms-dim" id="compareHint" style="margin-top:10px;">
      Pick two teams and press “Generate”.
    </div>

    <!--AI Summary -->
    <div class="ms-card ms-ai-card" id="aiSummaryCard" style="display:none; margin-top:12px;">
      <div class="ms-card-h">
        <span class="ms-pill">Executive Summary</span>
        <span class="ms-dim">AI-style (deterministic)</span>
      </div>
      <div id="aiSummaryText" class="ms-ai-text"></div>
    </div>
  </div>
</section>

<script>
  window.MS = window.MS || {};
  window.MS.mysticsPpgUrl = "{% url 'mystics_site:api_mystics_ppg' %}?season={{ season }}";
  window.MS.teamQuarterUrlTemplate = "{% url 'mystics_site:api_team_quarter_averages' 0 %}";
  window.MS.compareTeamsUrl = "{% url 'mystics_site:api_compare_teams' %}";
</script>

<script defer src="{% static 'mystics_site/js/executive_dashboard.js' %}"></script>
{% endblock %}
